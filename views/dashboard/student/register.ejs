<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
      body {
        font-family: "Tajawal", sans-serif;
      }
      /* Ø¶Ù…Ø§Ù† Ø£Ù† Ù†Øµ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø± ÙŠØ¸Ù‡Ø± Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
      input[type="radio"]:checked + label span {
        color: white !important;
      }
      /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù€ Spinner */
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 1.5rem;
        height: 1.5rem;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body
    class="bg-indigo-50 min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative"
  >
    <a
      href="/"
      class="absolute top-6 right-6 flex items-center text-sm font-medium text-gray-700 hover:text-indigo-600 transition duration-150 p-2 rounded-lg bg-white shadow-md border border-gray-100"
    >
      <i data-feather="arrow-right" class="mr-2 w-4 h-4"></i>
      Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </a>

    <div
      class="max-w-lg w-full space-y-8 p-10 bg-white rounded-xl shadow-2xl border border-gray-100"
    >
      <div class="text-center">
        <h1
          class="text-3xl font-extrabold text-indigo-700 flex items-center justify-center"
        >
          <i data-feather="user-plus" class="ml-3 w-8 h-8"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        </h1>
        <p class="mt-2 text-sm text-gray-600">
          Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø¹Ù†Ø§ Ø§Ù„ÙŠÙˆÙ…
        </p>
      </div>

      <form class="mt-8 space-y-6" onsubmit="handleSubmit(event)" method="POST">
        <div>
          <label for="full-name" class="block text-sm font-medium text-gray-700"
            >Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label
          >
          <input
            id="name"
            name="name"
            type="text"
            autocomplete="name"
            required
            class="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            placeholder="Ù…Ø«Ø§Ù„: Ø®Ø§Ù„Ø¯ Ù…Ø­Ù…Ø¯"
          />
        </div>

        <div>
          <label
            for="email-address"
            class="block text-sm font-medium text-gray-700"
            >Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label
          >
          <input
            id="email"
            name="email"
            type="email"
            autocomplete="email"
            required
            class="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            placeholder="example@domain.com"
          />
        </div>

        <div>
          <label
            for="phone-number"
            class="block text-sm font-medium text-gray-700"
            >Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label
          >
          <div class="mt-1 flex gap-2">
            <select
              id="country_code"
              name="country_code"
              class="w-1/3 border border-gray-300 rounded-md px-3 py-3 text-gray-900 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            >
              <option value="+966">ğŸ‡¸ğŸ‡¦ (+966)</option>
              <option value="+971">ğŸ‡¦ğŸ‡ª (+971)</option>
              <option value="+20">ğŸ‡ªğŸ‡¬ (+20)</option>
              <option value="+965">ğŸ‡°ğŸ‡¼ (+965)</option>
              <option value="+974">ğŸ‡¶ğŸ‡¦ (+974)</option>
              <option value="+968">ğŸ‡´ğŸ‡² (+968)</option>
            </select>
            <input
              id="phone_number"
              name="phone_number"
              type="tel"
              autocomplete="tel"
              required
              class="w-2/3 appearance-none relative block px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              placeholder="50XXXXXXX"
            />
          </div>
          <p class="mt-1 text-xs text-gray-500">
            Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø².
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Ø§Ù„Ù†ÙˆØ¹:</label
          >
          <div class="flex gap-6">
            <label class="inline-flex items-center">
              <input
                id="male"
                type="radio"
                name="gender"
                value="male"
                required
                class="form-radio text-indigo-600 w-4 h-4"
              />
              <span class="mr-2 text-gray-700">Ø°ÙƒØ±</span>
            </label>
            <label class="inline-flex items-center">
              <input
                id="female"
                type="radio"
                name="gender"
                value="female"
                required
                class="form-radio text-indigo-600 w-4 h-4"
              />
              <span class="mr-2 text-gray-700">Ø£Ù†Ø«Ù‰</span>
            </label>
          </div>
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700"
            >ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label
          >
          <input
            id="password"
            name="password"
            type="password"
            autocomplete="new-password"
            required
            class="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©"
          />
        </div>

        <div>
          <label
            for="confirm-password"
            class="block text-sm font-medium text-gray-700"
            >ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label
          >
          <input
            id="confirm-password"
            name="confirm_password"
            type="password"
            autocomplete="new-password"
            required
            class="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
          />
        </div>

        <div>
          <button
            id="saveBtn"
            type="submit"
            class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150"
          >
            <i data-feather="log-in" class="ml-3 w-5 h-5"></i>
            ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
      </form>

      <div class="mt-6 text-center">
        <p class="text-sm text-gray-600">
          Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
          <a
            href="/student/login"
            class="font-medium text-indigo-600 hover:text-indigo-500"
          >
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          </a>
        </p>
      </div>
    </div>
    <div
      id="toastContainer"
      class="fixed bottom-4 right-4 z-[70] space-y-3"
    ></div>
    <script>
      feather.replace();

      const saveBtn = document.getElementById("saveBtn");
      const spinner = document.getElementById("spinner");
      const originalButtonText = saveBtn.textContent.trim(); // Ø­ÙØ¸ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø²Ø±

      // ----------------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± -----------------

      /**
       * ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Loading) Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±.
       */
      function startLoading() {
        saveBtn.disabled = true;
        saveBtn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...";
      }

      /**
       * Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø²Ø± Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.
       */
      function stopLoading() {
        saveBtn.disabled = false;
        saveBtn.textContent = originalButtonText; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
      }

      // ----------------- Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Toast) -----------------

      /**
       * Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†Ø¨Ø«Ù‚ (Toast Notification)
       * @param {string} message - Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
       * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: 'success', 'error', 'info'.
       */
      function showToast(message, type = "info") {
        const container = document.getElementById("toastContainer");
        const toast = document.createElement("div");

        let bgColor = "bg-blue-600";
        let icon = "info";

        switch (type) {
          case "success":
            bgColor = "bg-green-600";
            icon = "check-circle";
            break;
          case "error":
            bgColor = "bg-red-600";
            icon = "alert-triangle";
            break;
          case "info":
          default:
            bgColor = "bg-blue-600";
            icon = "info";
            break;
        }

        toast.className = `p-4 max-w-xs text-white ${bgColor} rounded-lg shadow-xl flex items-center transform transition-transform duration-300 translate-x-full`;
        toast.innerHTML = `
                <i data-feather="${icon}" class="w-5 h-5 ml-3"></i>
                <span class="text-sm font-medium">${message}</span>
                <button onclick="this.closest('div').remove()" class="mr-2 text-white/80 hover:text-white transition-colors">
                    <i data-feather="x" class="w-4 h-4"></i>
                </button>
            `;

        container.appendChild(toast);
        feather.replace();

        setTimeout(() => {
          toast.classList.remove("translate-x-full");
        }, 10);

        setTimeout(() => {
          toast.classList.add("translate-x-full");
          toast.addEventListener("transitionend", () => toast.remove(), {
            once: true,
          });
        }, 5000);
      }

      // ----------------- Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Handle Submit) -----------------

      /**
       * Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ø³ØªØ¯Ø¹Ø§Ø¡ Fetch API.
       */
      async function handleSubmit(event) {
        event.preventDefault();

        const form = event.target;
        const selectedGender = document.querySelector(
          'input[name="gender"]:checked'
        );

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù‚ÙŠÙ…Ø©ØŒ Ø«Ù… Ø§Ø³ØªØ®Ø±Ø§Ø¬Ù‡Ø§
        const genderValue = selectedGender ? selectedGender.value : "";
        const userData = {
          // ... (Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ...
          country_code: document.getElementById("country_code").value,
          phone_number: document.getElementById("phone_number").value,
          gender: genderValue,
          role: "student",
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          password: document.getElementById("password").value,
          confirm_Password: document.getElementById("confirm-password").value,
        };
        startLoading(); // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„

        try {
          const response = await fetch("/student/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(userData),
          });


          if (!response.ok) {
            const errorData = await response.json();

            throw errorData;
          }
          // Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:
          const successData = await response.json();
          stopLoading();
          showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! (", "success");

          // â­ï¸ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù‡Ù†Ø§: Ù†Ø¤Ø®Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù€ Toast
          setTimeout(() => {
            window.location.href = "/student/login"; // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          }, 800);
        } catch (error) {
          stopLoading();

          showToast("Ø®Ø·Ø£: " + error["error"], "error");
        }
      }
    </script>
  </body>
</html>
