<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุชุญูู ุงูุทุงูุจ - ุงูุฑุฆูุณูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; }
        .sidebar-link { transition: all 0.2s; }
        .sidebar-link.active { background-color: #eef2ff; color: #4f46e5; font-weight: 700; border-right: 3px solid #4f46e5; }
        .sidebar-link:not(.active):hover { background-color: #f3f4f6; color: #4f46e5; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="flex h-screen overflow-hidden">
        <a href="/admin">
        <div class="w-64 bg-white border-l border-gray-200 flex flex-col flex-shrink-0">
            <div class="h-16 flex items-center justify-center border-b border-gray-200">
                <span class="text-2xl font-extrabold tracking-wider text-indigo-700">๐ ููุตุฉ ุงูุทูู</span>
            </div>
            </a>
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <a href="student-dashboard.html" class="sidebar-link active flex items-center px-4 py-3 rounded-lg text-gray-700">
                    <i data-feather="home" class="ml-3 w-5 h-5"></i>
                    ุงูุฑุฆูุณูุฉ
                </a>
                
                <a href="/student/my-sessions" class="sidebar-link flex items-center px-4 py-3 rounded-lg text-gray-700">
                    <i data-feather="calendar" class="ml-3 w-5 h-5"></i>
                    ุญุตุตู ุงููุฌุฏููุฉ
                </a>

                <a href="/student/courses_list" class="sidebar-link flex items-center px-4 py-3 rounded-lg text-gray-700">
                    <i data-feather="book-open" class="ml-3 w-5 h-5"></i>
                    ุงุณุชุนุฑุงุถ ุงูููุฑุณุงุช
                </a>
                 <a href="/student/enrolled_subscription" 
   class="sidebar-link flex items-center px-4 py-3 rounded-lg text-gray-700 transition duration-150 ease-in-out hover:bg-indigo-50 hover:text-indigo-600 font-medium">
    
    <i data-feather="file-text" class="ml-3 w-5 h-5"></i> 
    
     ุทูุจุงุช ุงูุงูุถูุงู
</a>
                
                <a href="/student/billing" class="sidebar-link flex items-center px-4 py-3 rounded-lg text-gray-700">
                    <i data-feather="dollar-sign" class="ml-3 w-5 h-5"></i>
                     ุงูุฑุตูุฏ ูุงูุฏูุน
                </a>

                <div class="pt-4 border-t border-gray-200 mt-4 space-y-1">
                    <a href="/student/settings" class="sidebar-link flex items-center px-4 py-3 rounded-lg text-gray-700">
                        <i data-feather="settings" class="ml-3 w-5 h-5"></i>
                        ุงูุฅุนุฏุงุฏุงุช
     
              <a href="#" onclick="openLogoutModal(event)" class="flex items-center justify-center p-2 text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition-colors font-medium">
    <i data-feather="log-out" class="ml-2 w-5 h-5"></i>
    ุชุณุฌูู ุงูุฎุฑูุฌ
</a>
<div id="logoutModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-xl overflow-hidden max-w-sm w-full mx-4" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        
        <div class="px-6 pt-5 pb-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                    <i data-feather="alert-triangle" class="h-6 w-6 text-red-600"></i>
                </div>
                <div class="mr-4 text-right">
                    <h3 class="text-lg leading-6 font-bold text-gray-900" id="modal-title">ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ</h3>
                    <div class="mt-2">
                        <p class="text-sm text-gray-500">
                            ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ ุณูุชู ุฅููุงุก ุฌูุณุชู ุงูุญุงููุฉ.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 px-4 py-3 sm:px-6 flex justify-between gap-3">
            
            <button type="button" onclick="closeLogoutModal()" class="w-full justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-100 sm:mt-0 sm:w-auto sm:text-sm transition-colors">
                ุฅูุบุงุก
            </button>
            
            <a id="confirmLogoutButton" href="/student/logout" class="w-full justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:w-auto sm:text-sm transition-colors flex items-center">
                <i data-feather="log-out" class="ml-1 w-4 h-4"></i>
                ูุนูุ ุชุณุฌูู ุงูุฎุฑูุฌ
            </a>
            
        </div>
    </div>
</div>
                </div>
            </nav>
        </div>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8">
                <h2 class="text-xl font-semibold text-gray-800">ุฃููุงู ุจูุ ูุญูุฏ ุงูุนูุงูู!</h2>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button class="text-gray-500 hover:text-indigo-600">
                        <i data-feather="bell" class="w-6 h-6"></i>
                    </button>
                    <div class="flex items-center gap-3 border-r pr-4">
                        <span class="text-sm font-medium text-gray-700">ุงูุฑุตูุฏ: 4 ุญุตุต ูุชุจููุฉ</span>
                        <a href="billing.html" class="text-sm text-indigo-600 hover:underline">ุฅุฏุงุฑุฉ</a>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-8">
                <div class="space-y-8">
<% 
// ===========================
// 1. ุชููุฆุฉ ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
// ===========================
let fullDateTime = 'ุฌุงุฑู ุงูุชุญููู...';
let tutorName = 'ุงููุนูู ุบูุฑ ูุชููุฑ';
let sessionTopic = 'ูู ูุชู ุชุญุฏูุฏ ุงูููุถูุน';
let joinUrl = '#';
let sessionState = 'none'; // ูููู ุฃู ูููู: 'upcoming', 'ongoing', 'none'
let countdownMs = 0;

if (nearestSession && nearestSession.sessionDetails && nearestSession.sessionDetails.date && nearestSession.sessionDetails.time) {
    const sessionDetails = nearestSession.sessionDetails;
    const rawDate = sessionDetails.date;
    const sessionTime = sessionDetails.time;
    const bookingId = nearestSession.bookingId;

    const dateObj = new Date(rawDate);
    const year = dateObj.getUTCFullYear();
    const month = String(dateObj.getUTCMonth() + 1).padStart(2, '0');
    const day = String(dateObj.getUTCDate()).padStart(2, '0');

    const finalISODateTime = `${year}-${month}-${day}T${sessionTime}:00`;
    const displayDateObj = new Date(finalISODateTime);

    const formattedDate = displayDateObj.toLocaleDateString('ar-SA', { 
        weekday: 'long', 
        day: 'numeric', 
        month: 'long',
        year: 'numeric'
    });
    const formattedTime = displayDateObj.toLocaleTimeString('ar-SA', { 
        hour: '2-digit', 
        minute: '2-digit', 
        hour12: true 
    });

    fullDateTime = `${formattedDate} | ${formattedTime}`;
    sessionTopic = sessionDetails.topic || 'ูู ูุชู ุชุญุฏูุฏ ุงูููุถูุน';
    joinUrl = `/student/session-details/${bookingId}/${sessionDetails._id}`;

    const now = new Date();
    const sessionStart = displayDateObj;
    const sessionEnd = new Date(sessionStart.getTime() + 60*60*1000); // ููุชุฑุถ ุฃู ุงูุญุตุฉ ุณุงุนุฉ ูุงุญุฏุฉ

    if(now >= sessionStart && now <= sessionEnd){
        sessionState = 'ongoing';
        countdownMs = sessionEnd.getTime() - now.getTime();
    } else if(now < sessionStart) {
        sessionState = 'upcoming';
    } else {
        sessionState = 'none';
    }
}
%>

<% if(sessionState === 'upcoming'){ %>
    <!-- ุงูุญุตุฉ ุงูููู ูุงุฏูุฉ ูููู ูู ุชุจุฏุฃ ุจุนุฏ -->
    <div class="bg-gradient-to-l from-indigo-700 to-indigo-600 text-white p-6 rounded-2xl shadow-xl transition duration-300 hover:shadow-indigo-500/50">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div class="flex items-start gap-4 mb-4 md:mb-0">
                <i data-feather="monitor" class="w-10 h-10 text-indigo-300 flex-shrink-0 mt-1"></i>
                <div>
                    <h3 class="text-2xl font-extrabold leading-tight mb-1">ูุฏูู ุญุตุฉ ุงูููู</h3>
                    <h3 class="text-2xl font-extrabold leading-tight mb-1">ุญุตุชู ุงููุงุฏูุฉ ูู ููุฑุณ: <%= nearestSession.courseTitle %></h3>
                    <p class="text-lg font-bold text-indigo-200 mb-2">
                        <i data-feather="calendar" class="w-4 h-4 mr-1 inline-block"></i>
                        <%= fullDateTime %>
                    </p>
                </div>
            </div>
            <div class="w-full md:w-auto text-right">
                <a href="<%= joinUrl %>" class="w-full md:w-auto inline-flex items-center justify-center px-6 py-3 bg-green-500 text-white rounded-xl text-lg font-bold hover:bg-green-600 transition duration-300 shadow-lg shadow-green-500/30">
                    <i data-feather="log-in" class="ml-2 w-5 h-5"></i>
                    ุงูุถู ูุบุฑูุฉ ุงูุงูุชุธุงุฑ
                </a>
            </div>
        </div>
    </div>
<% } else if(sessionState === 'ongoing'){ %>
    <!-- ุงูุญุตุฉ ุฌุงุฑูู ุงูุขู -->
    <div class="bg-gradient-to-r from-red-600 via-orange-500 to-red-700 text-white p-6 rounded-3xl shadow-2xl border-4 border-yellow-400 animate-pulse">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex flex-col gap-3">
                <h2 class="text-3xl font-extrabold tracking-wide">๐ฅ ุงูุญุตุฉ ุฌุงุฑูุฉ ุงูุขู!</h2>
                <h3 class="text-xl font-bold">ุญุตุชู ูู ููุฑุณ: <%= nearestSession.courseTitle %></h3>
                <p class="text-lg font-medium">ุงูููุช: <%= fullDateTime %></p>
                <p class="text-2xl font-extrabold mt-2">ููุชูู ุจุนุฏ: <span id="countdown" class="inline-block bg-yellow-200 text-red-700 px-3 py-1 rounded-lg font-mono"></span></p>
            </div>
            <div class="w-full md:w-auto">
                <a href="<%= joinUrl %>" class="inline-flex items-center justify-center px-8 py-4 bg-yellow-400 text-red-700 font-bold text-xl rounded-2xl shadow-xl hover:bg-yellow-300 hover:scale-105 transition-transform duration-300">
                    <i data-feather="log-in" class="w-6 h-6 mr-2"></i>
                    ุงูุถู ุงูุขู
                </a>
            </div>
        </div>
    </div>

    <script>
    let countdownMs = <%= countdownMs %>;
    const countdownEl = document.getElementById('countdown');

    function updateCountdown() {
        if(countdownMs <= 0){
            countdownEl.innerText = 'ุงูุชูุช ุงูุญุตุฉ';
            clearInterval(timer);
            return;
        }
        const minutes = Math.floor(countdownMs / 60000);
        const seconds = Math.floor((countdownMs % 60000) / 1000);
        countdownEl.innerText = `${minutes} : ${seconds} ุซุงููุฉ`;
        countdownMs -= 1000;
    }

    const timer = setInterval(updateCountdown, 1000);
    updateCountdown();
    </script>
<% } else { %>
    <!-- ูุง ุชูุฌุฏ ุญุตุต ุงูููู -->
   <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-8 border-indigo-500 text-center ring-2 ring-indigo-100 transition duration-300 hover:shadow-indigo-300/50">
        
        <i data-feather="calendar-off" class="w-12 h-12 mx-auto mb-4 text-indigo-600"></i>
        
        <p class="text-2xl font-extrabold text-gray-800 mb-2">
            ูุง ุชูุฌุฏ ุญุตุต ููุฌุฏููุฉ ูู ุงูููู
        </p>
        
        <p class="text-lg text-gray-600 mb-6">
            ุงุทูุฆูุ ููููู ูุฑุงุฌุนุฉ ุฌุฏููู ุงููุงูู ููุญุตุต ุงููุงุฏูุฉ.
        </p>
        
        <a href="/student/my-sessions" 
           class="mt-4 inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-xl text-lg font-bold hover:bg-indigo-700 transition duration-300 shadow-md shadow-indigo-500/30">
            <i data-feather="list" class="ml-2 w-5 h-5"></i>
            ุนุฑุถ ุงูุฌุฏูู ูุงูุชุญูู ูู ุงูููุงุนูุฏ
        </a>
        
    </div>
<% } %>

                   
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        
                        <div class="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex items-center gap-4">
                            <i data-feather="check-square" class="w-8 h-8 text-green-500 bg-green-100 p-2 rounded-full"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-500">ุญุตุต ููุชููุฉ</p>
                                <p class="text-2xl font-bold text-gray-900">12</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex items-center gap-4">
                            <i data-feather="star" class="w-8 h-8 text-yellow-500 bg-yellow-100 p-2 rounded-full"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-500">ุชููููู ุงููุชูุณุท</p>
                                <p class="text-2xl font-bold text-gray-900">4.8</p>
                            </div>
                        </div>

                        <div class="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex items-center gap-4">
                            <i data-feather="zap" class="w-8 h-8 text-red-500 bg-red-100 p-2 rounded-full"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-500">ุฏูุงุฆู ุงูุชุนูู ุงูุฅุฌูุงููุฉ</p>
                                <p class="text-2xl font-bold text-gray-900">720 ุฏูููุฉ</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex items-center gap-4">
                            <i data-feather="package" class="w-8 h-8 text-indigo-500 bg-indigo-100 p-2 rounded-full"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-500">ุฎุทุชู ุงููุดุทุฉ</p>
                                <p class="text-2xl font-bold text-gray-900">ุงูุฑูุงุถูุงุช (8 ุญุตุต)</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md border border-gray-100">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-feather="activity" class="ml-2 w-5 h-5 text-indigo-600"></i> ุฃุญุฏุซ ุงูุฃูุดุทุฉ ุงูุฃุฎูุฑุฉ</h3>
                            <ul class="space-y-4">
                                <li class="flex items-start border-b pb-4">
                                    <i data-feather="star" class="w-5 h-5 text-yellow-500 mt-1 ml-3 flex-shrink-0"></i>
                                    <div>
                                        <p class="font-medium text-gray-900">ุชูููู ููุชุงุฒ! (5 ูุฌูู)</p>
                                        <p class="text-sm text-gray-600">ุชู ุชูููู ุญุตุฉ "ููุฏูุฉ ูู ุงูุจุฑูุฌุฉ" ูุน ุงููุนูู ุฎุงูุฏ ุนูู.</p>
                                        <p class="text-xs text-gray-400 mt-1">ูุจู ููููู</p>
                                    </div>
                                </li>
                                <li class="flex items-start border-b pb-4">
                                    <i data-feather="credit-card" class="w-5 h-5 text-green-500 mt-1 ml-3 flex-shrink-0"></i>
                                    <div>
                                        <p class="font-medium text-gray-900">ุชู ุชุฌุฏูุฏ ุงูุฎุทุฉ ุงูุดูุฑูุฉ</p>
                                        <p class="text-sm text-gray-600">ุชู ุฏูุน ุงุดุชุฑุงู ุงูุฑูุงุถูุงุช ุงููุชูุฏูุฉ (8 ุญุตุต) ุจูุฌุงุญ.</p>
                                        <p class="text-xs text-gray-400 mt-1">ูุจู ุฃุณุจูุน</p>
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <i data-feather="calendar-plus" class="w-5 h-5 text-indigo-500 mt-1 ml-3 flex-shrink-0"></i>
                                    <div>
                                        <p class="font-medium text-gray-900">ุญุฌุฒ ุญุตุฉ ุฌุฏูุฏุฉ</p>
                                        <p class="text-sm text-gray-600">ุชู ุญุฌุฒ ุญุตุฉ "ูุชุงุจุฉ ุงูููุงูุงุช" ุจุชุงุฑูุฎ 2025/12/15.</p>
                                        <p class="text-xs text-gray-400 mt-1">ุงูููู</p>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md border border-gray-100">
                             <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-feather="message-square" class="ml-2 w-5 h-5 text-indigo-600"></i> ููุงุญุธุฉ ุงููุนูู ุงูุฃุฎูุฑุฉ</h3>
                            
                            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <p class="text-sm font-semibold text-gray-700">ุงููุนููุฉ ููุฑุฉ ููุฏ</p>
                                <p class="text-xs text-gray-500 mb-2">ููุฐ 3 ุฃูุงู (ุญุตุต ุงูุฅูุฌููุฒูุฉ)</p>
                                <blockquote class="text-gray-700 italic border-r-4 border-indigo-400 pr-3 mt-2">
                                    "ูุฌุจ ุงูุชุฑููุฒ ุฃูุซุฑ ุนูู ุงูุฃุฒููุฉ ุงููุชูุฏูุฉ. ุชู ุฅุฑุณุงู ูุงุฌุจ ุฅุถุงูู ูุชูููุฉ ููุงุฑุฉ ุงูุชุญุฏุซ."
                                </blockquote>
                            </div>

                            <a href="my-sessions.html" class="mt-4 block text-center text-sm text-indigo-600 hover:underline">
                                ุนุฑุถ ูู ุงูููุงุญุธุงุช ูุงูุชูุงุฑูุฑ
                            </a>
                        </div>
                    </div>
                    
                </div>
            </main>
        </div>
    </div>
    
    <script>
        feather.replace();
        const logoutModal = document.getElementById('logoutModal');

/**
 * ูุชุญ ูุงูุฐุฉ ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
 * @param {Event} event - ูููุน ุงูุณููู ุงูุงูุชุฑุงุถู ููุฑุงุจุท.
 */
function openLogoutModal(event) {
    event.preventDefault(); // ููุน ุงูุชุญููู ุงููุจุงุดุฑ
    logoutModal.classList.remove('hidden');
    logoutModal.classList.add('flex'); // ูุฌุนููุง ุธุงูุฑุฉ ูู ุงูููุชุตู
}

/**
 * ุฅุบูุงู ูุงูุฐุฉ ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
 */
function closeLogoutModal() {
    logoutModal.classList.remove('flex');
    logoutModal.classList.add('hidden');
}

    </script>
</body>
</html>